os: linux
dist: trusty
language: go

go:
  - "1.14"

env:
  - DOCKERHUB_REPOSITORY=inspirum/go-modules-test

services:
  - docker

script:
  - go mod download
  - go test
  - docker build --no-cache -t "latest" .
#  - docker build --no-cache -t "$TRAVIS_TAG" .

after_success:
  - echo $DOCKER_PASSWORD | docker login --username $DOCKER_USER --password-stdin
  - docker tag "latest" $DOCKERHUB_REPOSITORY:$TRAVIS_BUILD_NUMBER
  - docker push $DOCKERHUB_REPOSITORY:$TRAVIS_BUILD_NUMBER
  - docker tag "latest" $DOCKERHUB_REPOSITORY:latest
  - docker push $DOCKERHUB_REPOSITORY:latest
